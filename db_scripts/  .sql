CREATE TABLE location_naics_features  AS (
WITH distance_features AS (
SELECT fl.loanid,
    fd.* 
    FROM feature_geo_distance_denue_naics_by_year_with_past fd
    JOIN feature_loans_colonia fl
    ON (fd.coloniaid = fl.coloniaid))
SELECT l.credit_id_41 as cv_credito_loc_naics,
    df.*,
case when no_employee_6111_0_2_5k <> 0 then  no_businesses_6111_0_2_5k/(cast (no_employee_6111_0_2_5k as double precision)) else 0 end as no_busemp_6111_0_2_5k,
case when no_employee_6111_0_5k <> 0 then no_businesses_6111_0_5k/(cast( no_employee_6111_0_5k as double precision)) else 0 end  as no_busemp_6111_0_5k,
case when no_employee_6111_0_10k <> 0 then no_businesses_6111_0_10k/(cast( no_employee_6111_0_10k as double precision)) else 0 end  as no_busemp_6111_0_10k,
case when no_employee_6111_0_15k <> 0 then no_businesses_6111_0_15k/(cast( no_employee_6111_0_15k as double precision)) else 0 end  as no_busemp_6111_0_15k,
case when no_employee_6111_0_20k <> 0 then no_businesses_6111_0_20k/(cast( no_employee_6111_0_20k as double precision)) else 0 end  as no_busemp_6111_0_20k,
case when no_employee_6111_0_25k <> 0 then no_businesses_6111_0_25k/(cast( no_employee_6111_0_25k as double precision)) else 0 end  as no_busemp_6111_0_25k,
case when no_employee_6111_0_30k <> 0 then no_businesses_6111_0_30k/(cast( no_employee_6111_0_30k as double precision)) else 0 end  as no_busemp_6111_0_30k,
case when no_employee_6111_0_35k <> 0 then no_businesses_6111_0_35k/(cast( no_employee_6111_0_35k as double precision)) else 0 end  as no_busemp_6111_0_35k,
case when no_employee_6111_0_40k <> 0 then no_businesses_6111_0_40k/(cast( no_employee_6111_0_40k as double precision)) else 0 end  as no_busemp_6111_0_40k,
case when no_employee_6111_0_45k <> 0 then no_businesses_6111_0_45k/(cast( no_employee_6111_0_45k as double precision)) else 0 end  as no_busemp_6111_0_45k,
case when no_employee_6111_0_50k <> 0 then no_businesses_6111_0_50k/(cast( no_employee_6111_0_50k as double precision)) else 0 end  as no_busemp_6111_0_50k,
case when no_employee_6111_2_5_5k <> 0   then no_businesses_6111_2_5_5k/(cast (no_employee_6111_2_5_5k as double precision)) else 0 end  as no_busemp_6111_2_5_5k,
case when no_employee_6111_5_10k <> 0 then  no_businesses_6111_5_10k/(cast (no_employee_6111_5_10k as double precision)) else 0 end   as no_busemp_6111_5_10k,
case when no_employee_6111_10_15k <> 0 then  no_businesses_6111_10_15k/(cast (no_employee_6111_10_15k as double precision)) else 0 end   as no_busemp_6111_10_15k,
case when no_employee_6111_15_20k <> 0 then  no_businesses_6111_15_20k/(cast (no_employee_6111_15_20k as double precision)) else 0 end   as no_busemp_6111_15_20k,
case when no_employee_6111_20_25k <> 0 then  no_businesses_6111_20_25k/(cast (no_employee_6111_20_25k as double precision)) else 0 end   as no_busemp_6111_20_25k,
case when no_employee_6111_25_30k <> 0 then  no_businesses_6111_25_30k/(cast (no_employee_6111_25_30k as double precision)) else 0 end   as no_busemp_6111_25_30k,
case when no_employee_6111_30_35k <> 0 then  no_businesses_6111_30_35k/(cast (no_employee_6111_30_35k as double precision)) else 0 end   as no_busemp_6111_30_35k,
case when no_employee_6111_35_40k <> 0 then  no_businesses_6111_35_40k/(cast (no_employee_6111_35_40k as double precision)) else 0 end   as no_busemp_6111_35_40k,
case when no_employee_6111_40_45k <> 0 then  no_businesses_6111_40_45k/(cast (no_employee_6111_40_45k as double precision)) else 0 end   as no_busemp_6111_40_45k,
case when no_employee_6111_45_50k <> 0 then  no_businesses_6111_45_50k/(cast (no_employee_6111_45_50k as double precision)) else 0 end   as no_busemp_6111_45_50k,
case when no_employee_622_0_2_5k <> 0 then  no_businesses_622_0_2_5k/(cast (no_employee_622_0_2_5k as double precision)) else 0 end as no_busemp_622_0_2_5k,
case when no_employee_622_0_5k <> 0 then no_businesses_622_0_5k/(cast( no_employee_622_0_5k as double precision)) else 0 end  as no_busemp_622_0_5k,
case when no_employee_622_0_10k <> 0 then no_businesses_622_0_10k/(cast( no_employee_622_0_10k as double precision)) else 0 end  as no_busemp_622_0_10k,
case when no_employee_622_0_15k <> 0 then no_businesses_622_0_15k/(cast( no_employee_622_0_15k as double precision)) else 0 end  as no_busemp_622_0_15k,
case when no_employee_622_0_20k <> 0 then no_businesses_622_0_20k/(cast( no_employee_622_0_20k as double precision)) else 0 end  as no_busemp_622_0_20k,
case when no_employee_622_0_25k <> 0 then no_businesses_622_0_25k/(cast( no_employee_622_0_25k as double precision)) else 0 end  as no_busemp_622_0_25k,
case when no_employee_622_0_30k <> 0 then no_businesses_622_0_30k/(cast( no_employee_622_0_30k as double precision)) else 0 end  as no_busemp_622_0_30k,
case when no_employee_622_0_35k <> 0 then no_businesses_622_0_35k/(cast( no_employee_622_0_35k as double precision)) else 0 end  as no_busemp_622_0_35k,
case when no_employee_622_0_40k <> 0 then no_businesses_622_0_40k/(cast( no_employee_622_0_40k as double precision)) else 0 end  as no_busemp_622_0_40k,
case when no_employee_622_0_45k <> 0 then no_businesses_622_0_45k/(cast( no_employee_622_0_45k as double precision)) else 0 end  as no_busemp_622_0_45k,
case when no_employee_622_0_50k <> 0 then no_businesses_622_0_50k/(cast( no_employee_622_0_50k as double precision)) else 0 end  as no_busemp_622_0_50k,
case when no_employee_622_2_5_5k <> 0 then no_businesses_622_2_5_5k/(cast (no_employee_622_2_5_5k as double precision)) else 0 end  as no_busemp_622_2_5_5k,
case when no_employee_622_5_10k <> 0 then  no_businesses_622_5_10k/(cast (no_employee_622_5_10k as double precision)) else 0 end   as no_busemp_622_5_10k,
case when no_employee_622_10_15k <> 0 then  no_businesses_622_10_15k/(cast (no_employee_622_10_15k as double precision)) else 0 end   as no_busemp_622_10_15k,
case when no_employee_622_15_20k <> 0 then  no_businesses_622_15_20k/(cast (no_employee_622_15_20k as double precision)) else 0 end   as no_busemp_622_15_20k,
case when no_employee_622_20_25k <> 0 then  no_businesses_622_20_25k/(cast (no_employee_622_20_25k as double precision)) else 0 end   as no_busemp_622_20_25k,
case when no_employee_622_25_30k <> 0 then  no_businesses_622_25_30k/(cast (no_employee_622_25_30k as double precision)) else 0 end   as no_busemp_622_25_30k,
case when no_employee_622_30_35k <> 0 then  no_businesses_622_30_35k/(cast (no_employee_622_30_35k as double precision)) else 0 end   as no_busemp_622_30_35k,
case when no_employee_622_35_40k <> 0 then  no_businesses_622_35_40k/(cast (no_employee_622_35_40k as double precision)) else 0 end   as no_busemp_622_35_40k,
case when no_employee_622_40_45k <> 0 then  no_businesses_622_40_45k/(cast (no_employee_622_40_45k as double precision)) else 0 end   as no_busemp_622_40_45k,
case when no_employee_622_45_50k <> 0 then  no_businesses_622_45_50k/(cast (no_employee_622_45_50k as double precision)) else 0 end   as no_busemp_622_45_50k,
case when no_employee_461_0_2_5k <> 0 then  no_businesses_461_0_2_5k/(cast (no_employee_461_0_2_5k as double precision)) else 0 end as no_busemp_461_0_2_5k,
case when no_employee_461_0_5k <> 0 then no_businesses_461_0_5k/(cast( no_employee_461_0_5k as double precision)) else 0 end  as no_busemp_461_0_5k,
case when no_employee_461_0_10k <> 0 then no_businesses_461_0_10k/(cast( no_employee_461_0_10k as double precision)) else 0 end  as no_busemp_461_0_10k,
case when no_employee_461_0_15k <> 0 then no_businesses_461_0_15k/(cast( no_employee_461_0_15k as double precision)) else 0 end  as no_busemp_461_0_15k,
case when no_employee_461_0_20k <> 0 then no_businesses_461_0_20k/(cast( no_employee_461_0_20k as double precision)) else 0 end  as no_busemp_461_0_20k,
case when no_employee_461_0_25k <> 0 then no_businesses_461_0_25k/(cast( no_employee_461_0_25k as double precision)) else 0 end  as no_busemp_461_0_25k,
case when no_employee_461_0_30k <> 0 then no_businesses_461_0_30k/(cast( no_employee_461_0_30k as double precision)) else 0 end  as no_busemp_461_0_30k,
case when no_employee_461_0_35k <> 0 then no_businesses_461_0_35k/(cast( no_employee_461_0_35k as double precision)) else 0 end  as no_busemp_461_0_35k,
case when no_employee_461_0_40k <> 0 then no_businesses_461_0_40k/(cast( no_employee_461_0_40k as double precision)) else 0 end  as no_busemp_461_0_40k,
case when no_employee_461_0_45k <> 0 then no_businesses_461_0_45k/(cast( no_employee_461_0_45k as double precision)) else 0 end  as no_busemp_461_0_45k,
case when no_employee_461_0_50k <> 0 then no_businesses_461_0_50k/(cast( no_employee_461_0_50k as double precision)) else 0 end  as no_busemp_461_0_50k,
case when no_employee_461_2_5_5k <> 0  then no_businesses_461_2_5_5k/(cast (no_employee_461_2_5_5k as double precision)) else 0 end  as no_busemp_461_2_5_5k,
case when no_employee_461_5_10k <> 0 then  no_businesses_461_5_10k/(cast (no_employee_461_5_10k as double precision)) else 0 end   as no_busemp_461_5_10k,
case when no_employee_461_10_15k <> 0 then  no_businesses_461_10_15k/(cast (no_employee_461_10_15k as double precision)) else 0 end   as no_busemp_461_10_15k,
case when no_employee_461_15_20k <> 0 then  no_businesses_461_15_20k/(cast (no_employee_461_15_20k as double precision)) else 0 end   as no_busemp_461_15_20k,
case when no_employee_461_20_25k <> 0 then  no_businesses_461_20_25k/(cast (no_employee_461_20_25k as double precision)) else 0 end   as no_busemp_461_20_25k,
case when no_employee_461_25_30k <> 0 then  no_businesses_461_25_30k/(cast (no_employee_461_25_30k as double precision)) else 0 end   as no_busemp_461_25_30k,
case when no_employee_461_30_35k <> 0 then  no_businesses_461_30_35k/(cast (no_employee_461_30_35k as double precision)) else 0 end   as no_busemp_461_30_35k,
case when no_employee_461_35_40k <> 0 then  no_businesses_461_35_40k/(cast (no_employee_461_35_40k as double precision)) else 0 end   as no_busemp_461_35_40k,
case when no_employee_461_40_45k <> 0 then  no_businesses_461_40_45k/(cast (no_employee_461_40_45k as double precision)) else 0 end   as no_busemp_461_40_45k,
case when no_employee_461_45_50k <> 0 then  no_businesses_461_45_50k/(cast (no_employee_461_45_50k as double precision)) else 0 end   as no_busemp_461_45_50k,
case when no_employee_46211_0_2_5k <> 0 then  no_businesses_46211_0_2_5k/(cast (no_employee_46211_0_2_5k as double precision)) else 0 end as no_busemp_46211_0_2_5k,
case when no_employee_46211_0_5k <> 0 then no_businesses_46211_0_5k/(cast( no_employee_46211_0_5k as double precision)) else 0 end  as no_busemp_46211_0_5k,
case when no_employee_46211_0_10k <> 0 then no_businesses_46211_0_10k/(cast( no_employee_46211_0_10k as double precision)) else 0 end  as no_busemp_46211_0_10k,
case when no_employee_46211_0_15k <> 0 then no_businesses_46211_0_15k/(cast( no_employee_46211_0_15k as double precision)) else 0 end  as no_busemp_46211_0_15k,
case when no_employee_46211_0_20k <> 0 then no_businesses_46211_0_20k/(cast( no_employee_46211_0_20k as double precision)) else 0 end  as no_busemp_46211_0_20k,
case when no_employee_46211_0_25k <> 0 then no_businesses_46211_0_25k/(cast( no_employee_46211_0_25k as double precision)) else 0 end  as no_busemp_46211_0_25k,
case when no_employee_46211_0_30k <> 0 then no_businesses_46211_0_30k/(cast( no_employee_46211_0_30k as double precision)) else 0 end  as no_busemp_46211_0_30k,
case when no_employee_46211_0_35k <> 0 then no_businesses_46211_0_35k/(cast( no_employee_46211_0_35k as double precision)) else 0 end  as no_busemp_46211_0_35k,
case when no_employee_46211_0_40k <> 0 then no_businesses_46211_0_40k/(cast( no_employee_46211_0_40k as double precision)) else 0 end  as no_busemp_46211_0_40k,
case when no_employee_46211_0_45k <> 0 then no_businesses_46211_0_45k/(cast( no_employee_46211_0_45k as double precision)) else 0 end  as no_busemp_46211_0_45k,
case when no_employee_46211_0_50k <> 0 then no_businesses_46211_0_50k/(cast( no_employee_46211_0_50k as double precision)) else 0 end  as no_busemp_46211_0_50k,
case when no_employee_46211_2_5_5k <> 0   then no_businesses_46211_2_5_5k/(cast (no_employee_46211_2_5_5k as double precision)) else 0 end  as no_busemp_46211_2_5_5k,
case when no_employee_46211_5_10k <> 0 then  no_businesses_46211_5_10k/(cast (no_employee_46211_5_10k as double precision)) else 0 end   as no_busemp_46211_5_10k,
case when no_employee_46211_10_15k <> 0 then  no_businesses_46211_10_15k/(cast (no_employee_46211_10_15k as double precision)) else 0 end   as no_busemp_46211_10_15k,
case when no_employee_46211_15_20k <> 0 then  no_businesses_46211_15_20k/(cast (no_employee_46211_15_20k as double precision)) else 0 end   as no_busemp_46211_15_20k,
case when no_employee_46211_20_25k <> 0 then  no_businesses_46211_20_25k/(cast (no_employee_46211_20_25k as double precision)) else 0 end   as no_busemp_46211_20_25k,
case when no_employee_46211_25_30k <> 0 then  no_businesses_46211_25_30k/(cast (no_employee_46211_25_30k as double precision)) else 0 end   as no_busemp_46211_25_30k,
case when no_employee_46211_30_35k <> 0 then  no_businesses_46211_30_35k/(cast (no_employee_46211_30_35k as double precision)) else 0 end   as no_busemp_46211_30_35k,
case when no_employee_46211_35_40k <> 0 then  no_businesses_46211_35_40k/(cast (no_employee_46211_35_40k as double precision)) else 0 end   as no_busemp_46211_35_40k,
case when no_employee_46211_40_45k <> 0 then  no_businesses_46211_40_45k/(cast (no_employee_46211_40_45k as double precision)) else 0 end   as no_busemp_46211_40_45k,
case when no_employee_46211_45_50k <> 0 then  no_businesses_46211_45_50k/(cast (no_employee_46211_45_50k as double precision)) else 0 end   as no_busemp_46211_45_50k,
case when no_employee_722_0_2_5k <> 0 then  no_businesses_722_0_2_5k/(cast (no_employee_722_0_2_5k as double precision)) else 0 end as no_busemp_722_0_2_5k,
case when no_employee_722_0_5k <> 0 then no_businesses_722_0_5k/(cast( no_employee_722_0_5k as double precision)) else 0 end  as no_busemp_722_0_5k,
case when no_employee_722_0_10k <> 0 then no_businesses_722_0_10k/(cast( no_employee_722_0_10k as double precision)) else 0 end  as no_busemp_722_0_10k,
case when no_employee_722_0_15k <> 0 then no_businesses_722_0_15k/(cast( no_employee_722_0_15k as double precision)) else 0 end  as no_busemp_722_0_15k,
case when no_employee_722_0_20k <> 0 then no_businesses_722_0_20k/(cast( no_employee_722_0_20k as double precision)) else 0 end  as no_busemp_722_0_20k,
case when no_employee_722_0_25k <> 0 then no_businesses_722_0_25k/(cast( no_employee_722_0_25k as double precision)) else 0 end  as no_busemp_722_0_25k,
case when no_employee_722_0_30k <> 0 then no_businesses_722_0_30k/(cast( no_employee_722_0_30k as double precision)) else 0 end  as no_busemp_722_0_30k,
case when no_employee_722_0_35k <> 0 then no_businesses_722_0_35k/(cast( no_employee_722_0_35k as double precision)) else 0 end  as no_busemp_722_0_35k,
case when no_employee_722_0_40k <> 0 then no_businesses_722_0_40k/(cast( no_employee_722_0_40k as double precision)) else 0 end  as no_busemp_722_0_40k,
case when no_employee_722_0_45k <> 0 then no_businesses_722_0_45k/(cast( no_employee_722_0_45k as double precision)) else 0 end  as no_busemp_722_0_45k,
case when no_employee_722_0_50k <> 0 then no_businesses_722_0_50k/(cast( no_employee_722_0_50k as double precision)) else 0 end  as no_busemp_722_0_50k,
case when no_employee_722_2_5_5k <> 0   then no_businesses_722_2_5_5k/(cast (no_employee_722_2_5_5k as double precision)) else 0 end  as no_busemp_722_2_5_5k,
case when no_employee_722_5_10k <> 0 then  no_businesses_722_5_10k/(cast (no_employee_722_5_10k as double precision)) else 0 end   as no_busemp_722_5_10k,
case when no_employee_722_10_15k <> 0 then  no_businesses_722_10_15k/(cast (no_employee_722_10_15k as double precision)) else 0 end   as no_busemp_722_10_15k,
case when no_employee_722_15_20k <> 0 then  no_businesses_722_15_20k/(cast (no_employee_722_15_20k as double precision)) else 0 end   as no_busemp_722_15_20k,
case when no_employee_722_20_25k <> 0 then  no_businesses_722_20_25k/(cast (no_employee_722_20_25k as double precision)) else 0 end   as no_busemp_722_20_25k,
case when no_employee_722_25_30k <> 0 then  no_businesses_722_25_30k/(cast (no_employee_722_25_30k as double precision)) else 0 end   as no_busemp_722_25_30k,
case when no_employee_722_30_35k <> 0 then  no_businesses_722_30_35k/(cast (no_employee_722_30_35k as double precision)) else 0 end   as no_busemp_722_30_35k,
case when no_employee_722_35_40k <> 0 then  no_businesses_722_35_40k/(cast (no_employee_722_35_40k as double precision)) else 0 end   as no_busemp_722_35_40k,
case when no_employee_722_40_45k <> 0 then  no_businesses_722_40_45k/(cast (no_employee_722_40_45k as double precision)) else 0 end   as no_busemp_722_40_45k,
case when no_employee_722_45_50k <> 0 then  no_businesses_722_45_50k/(cast (no_employee_722_45_50k as double precision)) else 0 end   as no_busemp_722_45_50k,
case when no_employee_81321_0_2_5k <> 0 then  no_businesses_81321_0_2_5k/(cast (no_employee_81321_0_2_5k as double precision)) else 0 end as no_busemp_81321_0_2_5k,
case when no_employee_81321_0_5k <> 0 then no_businesses_81321_0_5k/(cast( no_employee_81321_0_5k as double precision)) else 0 end  as no_busemp_81321_0_5k,
case when no_employee_81321_0_10k <> 0 then no_businesses_81321_0_10k/(cast( no_employee_81321_0_10k as double precision)) else 0 end  as no_busemp_81321_0_10k,
case when no_employee_81321_0_15k <> 0 then no_businesses_81321_0_15k/(cast( no_employee_81321_0_15k as double precision)) else 0 end  as no_busemp_81321_0_15k,
case when no_employee_81321_0_20k <> 0 then no_businesses_81321_0_20k/(cast( no_employee_81321_0_20k as double precision)) else 0 end  as no_busemp_81321_0_20k,
case when no_employee_81321_0_25k <> 0 then no_businesses_81321_0_25k/(cast( no_employee_81321_0_25k as double precision)) else 0 end  as no_busemp_81321_0_25k,
case when no_employee_81321_0_30k <> 0 then no_businesses_81321_0_30k/(cast( no_employee_81321_0_30k as double precision)) else 0 end  as no_busemp_81321_0_30k,
case when no_employee_81321_0_35k <> 0 then no_businesses_81321_0_35k/(cast( no_employee_81321_0_35k as double precision)) else 0 end  as no_busemp_81321_0_35k,
case when no_employee_81321_0_40k <> 0 then no_businesses_81321_0_40k/(cast( no_employee_81321_0_40k as double precision)) else 0 end  as no_busemp_81321_0_40k,
case when no_employee_81321_0_45k <> 0 then no_businesses_81321_0_45k/(cast( no_employee_81321_0_45k as double precision)) else 0 end  as no_busemp_81321_0_45k,
case when no_employee_81321_0_50k <> 0 then no_businesses_81321_0_50k/(cast( no_employee_81321_0_50k as double precision)) else 0 end  as no_busemp_81321_0_50k,
case when no_employee_81321_2_5_5k <> 0   then no_businesses_81321_2_5_5k/(cast (no_employee_81321_2_5_5k as double precision)) else 0 end  as no_busemp_81321_2_5_5k,
case when no_employee_81321_5_10k <> 0 then  no_businesses_81321_5_10k/(cast (no_employee_81321_5_10k as double precision)) else 0 end   as no_busemp_81321_5_10k,
case when no_employee_81321_10_15k <> 0 then  no_businesses_81321_10_15k/(cast (no_employee_81321_10_15k as double precision)) else 0 end   as no_busemp_81321_10_15k,
case when no_employee_81321_15_20k <> 0 then  no_businesses_81321_15_20k/(cast (no_employee_81321_15_20k as double precision)) else 0 end   as no_busemp_81321_15_20k,
case when no_employee_81321_20_25k <> 0 then  no_businesses_81321_20_25k/(cast (no_employee_81321_20_25k as double precision)) else 0 end   as no_busemp_81321_20_25k,
case when no_employee_81321_25_30k <> 0 then  no_businesses_81321_25_30k/(cast (no_employee_81321_25_30k as double precision)) else 0 end   as no_busemp_81321_25_30k,
case when no_employee_81321_30_35k <> 0 then  no_businesses_81321_30_35k/(cast (no_employee_81321_30_35k as double precision)) else 0 end   as no_busemp_81321_30_35k,
case when no_employee_81321_35_40k <> 0 then  no_businesses_81321_35_40k/(cast (no_employee_81321_35_40k as double precision)) else 0 end   as no_busemp_81321_35_40k,
case when no_employee_81321_40_45k <> 0 then  no_businesses_81321_40_45k/(cast (no_employee_81321_40_45k as double precision)) else 0 end   as no_busemp_81321_40_45k,
case when no_employee_81321_45_50k <> 0 then  no_businesses_81321_45_50k/(cast (no_employee_81321_45_50k as double precision)) else 0 end   as no_busemp_81321_45_50k

    FROM distance_features df 
    JOIN clean_loans_by_year l
    ON (df.loanid = l.id
        AND df.cur_year_fgdn = l.cur_year
        AND df.past_fgdn = l.past));

ALTER TABLE location_naics_features
        DROP COLUMN loanid,
        DROP COLUMN coloniaid;

CREATE INDEX idx_location_naics_features_cv_credito_loc_naics_cur_year_fgdn_past_fgdn ON location_naics_features (cv_credito_loc_naics, cur_year_fgdn, past_fgdn);
